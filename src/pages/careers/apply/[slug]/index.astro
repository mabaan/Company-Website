---
// IMPORTS
import Layout from "../../../../layouts/BaseLayout.astro";
import { getJobs, type Job } from "../../../../lib/jobs";
import { getCountryList } from "../../../../lib/getCountryData";
import type { Country } from "../../../../lib/getCountryData";

// STATIC PATHS
export async function getStaticPaths() {
  const jobs = await getJobs();
  return jobs.map((job) => ({
    params: { slug: job.slug },
    props: { job },
  }));
}

// PROPS
const { job } = Astro.props as { job: Job };
const countryCodes: Country[] = (await getCountryList()).sort((a, b) =>
  a.name.localeCompare(b.name)
);
---

<Layout title={`Apply | ${job.title} | GC International`}>
  <section class="pt-32 pb-12 px-4 max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold mb-4">Apply for {job.title}</h1>

    <form
      method="POST"
      action={`/careers/apply/${job.slug}/review`}
      enctype="multipart/form-data"
      class="space-y-6"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input name="firstName" placeholder="First Name" required class="border px-4 py-2 rounded" />
        <input name="lastName" placeholder="Last Name" required class="border px-4 py-2 rounded" />
        <input name="email" type="email" placeholder="Email" required class="border px-4 py-2 rounded md:col-span-2" />

        <select name="countryCode" required class="border px-3 py-2 rounded">
          <option value="" disabled selected>-- Select your country code --</option>
          {countryCodes.map((country: Country) => (
            <option value={country.dial_code}>
              {country.name} {country.flag} ({country.code}) {country.dial_code}
            </option>
          ))}
        </select>

        <input name="phone" placeholder="Phone" required class="border px-4 py-2 rounded" />

        <div>
          <label class="block font-medium mb-1">Gender *</label>
          <div class="flex gap-4">
            <label><input type="radio" name="gender" value="Male" required /> Male</label>
            <label><input type="radio" name="gender" value="Female" required /> Female</label>
          </div>
        </div>

        <input name="nationality" placeholder="Nationality" required class="border px-4 py-2 rounded" />
        <input name="dob" type="date" required class="border px-4 py-2 rounded" />

        <select name="visa" required class="border px-4 py-2 rounded">
          <option value="">-- Visa Status --</option>
          <option value="Visit">Visit</option>
          <option value="Work">Work</option>
          <option value="Student">Student</option>
          <option value="Golden">Golden</option>
          <option value="Resident">Resident</option>
          <option value="None">None</option>
        </select>

        <input name="experience" type="number" min="0" placeholder="Years of Experience" required class="border px-4 py-2 rounded" />
        <input name="linkedin" placeholder="LinkedIn (optional)" class="border px-4 py-2 rounded md:col-span-2" />

        <textarea name="about" rows="4" placeholder="Tell us about yourself (optional)" class="border px-4 py-2 rounded md:col-span-2"></textarea>

        <div class="md:col-span-2">
          <label class="block font-medium mb-2">Resume (under 1 MB only) *</label>
          <input
            id="resumeInput"
            name="resume"
            type="file"
            accept="application/pdf"
            required
            class="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-[#dfdfdf] file:text-black hover:file:bg-red-600"
          />
        </div>
      </div>

      <div class="pt-6 flex justify-between">
        <a href={`/careers/${job.slug}`} class="bg-[#ed1c24] hover:bg-red-600 text-white px-6 py-2 rounded text-sm font-medium">
          Back to Job
        </a>
        <button type="submit" class="bg-[#0054a4] hover:bg-blue-700 text-white px-6 py-2 rounded text-sm font-medium">
          Next: Review Application
        </button>
      </div>
    </form>
  </section>

  <!-- âœ… Resume size check -->
  <script>
    document.addEventListener("submit", function (e) {
      const form = e.target as HTMLFormElement | null;
      const fileInput = form?.querySelector('#resumeInput') as HTMLInputElement | null;

      if (fileInput?.files?.[0] && fileInput.files[0].size > 1048576) {
        e.preventDefault();
        alert("Resume must be under 1 MB.");
      }
    });
  </script>
</Layout>
