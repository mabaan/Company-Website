---
import Layout from "../../../layouts/BaseLayout.astro";
import { getJobs } from "../../../lib/jobs";

interface FormData {
  firstName: string;
  lastName: string;
  email: string;
  countryCode: string;
  phone: string;
  gender: string;
  nationality: string;
  dob: string;
  visa: string;
  experience: string;
  linkedin?: string;
  about: string;
}

const { request, url, params } = Astro;
const jobs = await getJobs();
const job = jobs.find((j) => j.slug === params.slug);

if (!job) throw new Error("Job not found");

const searchParams = new URL(url).searchParams;
const raw = searchParams.get("data");

if (!raw) throw new Error("No form data found");

const data = JSON.parse(decodeURIComponent(raw)) as FormData;
---

<Layout title={`Confirm Application | ${job.title}`}>
  <section class="py-20 px-6 bg-[#f9f9f9] min-h-screen">
    <div class="max-w-2xl mx-auto bg-white shadow-md rounded-lg p-8 border border-gray-200">
      <div class="space-y-3 text-sm">
        <p><strong>Name:</strong> {data.firstName} {data.lastName}</p>
        <p><strong>Email:</strong> {data.email}</p>
        <p><strong>Phone:</strong> {data.countryCode} {data.phone}</p>
        <p><strong>Gender:</strong> {data.gender}</p>
        <p><strong>Nationality:</strong> {data.nationality}</p>
        <p><strong>Date of Birth:</strong> {data.dob}</p>
        <p><strong>Visa Status:</strong> {data.visa}</p>
        <p><strong>Experience:</strong> {data.experience} years</p>
        <p><strong>LinkedIn:</strong> {data.linkedin || "N/A"}</p>
        <p><strong>About You:</strong> {data.about}</p>
        <p><strong>Resume:</strong> Attached (PDF)</p>
      </div>

      <form action={`/careers/apply/${job.slug}/confirmation`} method="POST" enctype="multipart/form-data" class="mt-8 space-y-4">
        {Object.entries(data).map(([key, value]) => (
          <input type="hidden" name={key} value={typeof value === "string" ? value : ""} />
        ))}
        <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Submit Application</button>
      </form>
    </div>
  </section>
</Layout>
